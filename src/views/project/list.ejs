<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/nav.css">
</head>
<body>
    <%- include('../partials/nav', { title: title, user: user }) %>
    
    <div class="container">
        <h2><%= title %></h2>

        <div class="board-actions">
            <form action="/project" method="GET" class="add-todo-form search-form">
                <input type="text" name="search" placeholder="제목 검색" value="<%= search %>" class="search-input">
                <button type="submit">검색</button>
            </form>
            
            <% if (user && user.email === 'admin@example.com') { %>
                <a href="/project/write" class="button">+ 프로젝트 추가</a>
            <% } %>
        </div>

        <table class="user-table">
            <thead>
                <tr>
                    <th class="col-id">번호</th>
                    <th class="col-title">제목</th>
                    <th class="col-author">작성자</th>
                    <th class="col-date">날짜</th>
                    <th class="col-views">조회수</th>
                </tr>
            </thead>
            <tbody>
                <% if(posts.length > 0) { %>
                    <% posts.forEach((post, index) => { %>
                    <tr>
                        <td><%= totalPosts - index %></td>
                        <td>
                            <a href="/project/view/<%= post.post_id %>" class="post-link">
                                <%= post.title %>
                            </a>
                        </td>
                        <td><%= post.author %></td>
                        <td><%= new Date(post.created_at).toLocaleDateString() %></td>
                        <td><%= post.views %></td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="5" class="table-empty">등록된 프로젝트가 없습니다.</td></tr>
                <% } %>
            </tbody>
        </table>

        <div class="pagination">
            <% if (totalPages > 1) { %>
                <% if (currentPage > 1) { %>
                    <a href="/project?page=<%= currentPage - 1 %>&search=<%= search %>">이전</a>
                <% } %>
                
                <% for (let i = 1; i <= totalPages; i++) { %>
                    <a href="/project?page=<%= i %>&search=<%= search %>" class="<%= i === parseInt(currentPage) ? 'active' : '' %>"><%= i %></a>
                <% } %>
                
                <% if (currentPage < totalPages) { %>
                    <a href="/project?page=<%= parseInt(currentPage) + 1 %>&search=<%= search %>">다음</a>
                <% } %>
            <% } %>
        </div>
    </div>
</body>
</html>