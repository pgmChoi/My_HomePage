<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/nav.css">
</head>
<body>
    <%- include('../partials/nav', { title: title, user: user }) %>
    <div class="container">
        <h2><%= title %></h2>

        <div class="board-actions">
            <form action="/board/<%= type %>" method="GET" class="add-todo-form search-form">
                <input type="text" name="search" placeholder="제목 검색" value="<%= search %>" class="search-input">
                <button type="submit">검색</button>
            </form>
            <% if (type === 'free' || (user && user.email === 'admin@example.com')) { %>
                <a href="/board/<%= type %>/write" class="button">글쓰기</a>
            <% } %>
        </div>

        <table class="user-table">
            <thead>
                <tr>
                    <th class="col-id">번호</th>
                    <th class="col-title">제목</th>
                    <th class="col-author">작성자</th>
                    <th class="col-date">날짜</th>
                    <th class="col-views">조회수</th>
                </tr>
            </thead>
            <tbody>
                <% if(posts.length > 0) { %>
                    <% posts.forEach((post, index) => { %>
                    <tr>
                        <td>
                            <%= totalPosts - ((currentPage - 1) * 10) - index %>
                        </td>
                        
                        <td>
                            <a href="/board/<%= type %>/view/<%= post.post_id %>" class="post-link">
                                <%= post.title %>
                            </a>
                        </td>
                        <td><%= post.author %></td>
                        <td><%= new Date(post.created_at).toLocaleDateString() %></td>
                        <td><%= post.views %></td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="5" class="table-empty">게시글이 없습니다.</td></tr>
                <% } %>
            </tbody>
        </table>

        <div class="pagination">
            <% if (totalPages > 1) { %>
                <% if (currentPage > 1) { %>
                    <a href="/board/<%= type %>?page=<%= currentPage - 1 %>&search=<%= search %>">이전</a>
                <% } %>
                <% for (let i = 1; i <= totalPages; i++) { %>
                    <a href="/board/<%= type %>?page=<%= i %>&search=<%= search %>" class="<%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                <% } %>
                <% if (currentPage < totalPages) { %>
                    <a href="/board/<%= type %>?page=<%= currentPage + 1 %>&search=<%= search %>">다음</a>
                <% } %>
            <% } %>
        </div>
    </div>
</body>
</html>